#!/bin/bash
set -e

echo "ğŸŸ¡ Limpiando carpeta de trabajo..."
rm -rf /opt/app-root/src/*

echo "ğŸŸ¡ Copiando cÃ³digo fuente desde /tmp/src..."
cp -R /tmp/src/. /opt/app-root/src/

echo "ğŸŸ¡ Eliminando archivos ocultos innecesarios..."
rm -rf /opt/app-root/src/.git*

echo "ğŸŸ¡ Instalando dependencias (si existe requirements.txt)..."
if [ -f /opt/app-root/src/requirements.txt ]; then
    pip install --no-cache-dir -r /opt/app-root/src/requirements.txt
else
    echo "âš ï¸ No se encontrÃ³ requirements.txt"
fi

echo "ğŸŸ¡ Ajustando permisos..."
chown -R 1001:0 /opt/app-root/src
chmod -R g+w /opt/app-root/src

echo "âœ… CÃ³digo copiado. Mostrando estructura del directorio:"
echo "---------------------------------------------"
find /opt/app-root/src -type f
echo "---------------------------------------------"
