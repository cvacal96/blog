#!/bin/bash
set -e

# Limpia la carpeta de trabajo
rm -rf /opt/app-root/src/*

# Copia todo (archivos, subdirectorios, archivos ocultos) desde /tmp/src
cp -R /tmp/src/. /opt/app-root/src/

# Elimina carpetas ocultas innecesarias (opcional)
rm -rf /opt/app-root/src/.git*

# Instala dependencias si existe requirements.txt
if [ -f /opt/app-root/src/requirements.txt ]; then
    pip install --no-cache-dir -r /opt/app-root/src/requirements.txt
fi

# Ajusta permisos
chown -R 1001:0 /opt/app-root/src
chmod -R g+w /opt/app-root/src